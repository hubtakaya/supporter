<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="utf-8">
	<title>もっと読む</title>
	<script
			  src="js/jquery-3.2.1.min.js"
			  crossorigin="anonymous"></script>
</head>
<body>
<h1>もっと読む</h1>
<ul id="tweets">
	
</ul>
<p id="loading" style="display:none;">loading...</p>
<!-- <input type="button" id="more" value="もっと読む"> -->

<script type="text/javascript" charset="utf-8" async defer>
	$(function() {
		var max_id = 1;

		$(window).scroll(function() {
			if($(window).scrollTop() + $(window).height() == $(document).height()){
				more();
			}
		});

		function more() {
			$('#loading').show();

			if($('#tweets > li').length) {
				max_id = $('#tweets > li:last').attr('id').replace(/^tweet-/, '');
				console.log(max_id);
			}

/*			$.get('read_more.php', {
				max_id: max_id
			}, function(rs) {
				$('#loading').hide();
				$(rs).appendTo('#tweets').hide().fadeIn(1000);
			});*/

			$.ajax({
				url: 'read_more.php',
				type: 'post',
				dataType: 'json',
				data: {
					max_id: max_id
				},
			})
			.done(function(response) {
				$('#loading').hide();
				$('#tweets').append(response.tweets);
			})
			.fail(function(e) {
				$('#loading').hide();
				alert('Ajax failed.');
				$('#tweets').append('<li>Ajax failed.</li>');
			});
		}

		more();

	});
</script>

</body>
</html>